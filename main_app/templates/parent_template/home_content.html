<!-- templates/parent_template/home_content.html -->
{% extends 'main_app/base.html' %}

{% block content %}

<div>
  <div class="title-1">News &amp; Events</div>
</div>

<div class="container-fluid">
  {% if items %}
<style>
    /* Card styling */
    .news-card {
        min-width: 250px;
        max-width: 250px;
        scroll-snap-align: start;
        flex: 0 0 auto;
        border-radius: 1rem;
        position: relative;
        transition: transform 0.2s ease;
    }
    .news-card:hover {
        transform: scale(1.03);
    }

    .news-slider {
        scroll-snap-type: x mandatory;
        -webkit-overflow-scrolling: touch;
        overflow-x: auto;
        gap: 1rem;
        display: flex;
        flex-wrap: nowrap;
        padding-bottom: 1rem;
        scrollbar-width: none;
    }
    .news-slider::-webkit-scrollbar {
        display: none;
    }

    /* Read more behavior */
    .summary-text {
        max-height: 80px;
        overflow: hidden;
        transition: max-height 0.3s ease;
    }
    .summary-text.expanded {
        max-height: 1000px;
    }
    .read-more {
        display: inline-block;
        margin-top: 5px;
        cursor: pointer;
        font-size: 0.85rem;
        color: #0d6efd;
    }

    /* Scroll buttons */
    .scroll-btn {
        position: absolute;
        top: 40%;
        z-index: 10;
        width: 35px;
        height: 35px;
        border-radius: 50%;
        opacity: 0.8;
        background-color: white;
        border: 1px solid #ccc;
    }
    .scroll-btn:hover {
        opacity: 1;
    }
    .left-scroll-btn {
        left: 10px;
        transform: translateY(-50%);
    }
    .right-scroll-btn {
        right: 10px;
        transform: translateY(-50%);
    }
</style>

<div class="position-relative px-3">
    <!-- Scroll Buttons -->
    <button class="scroll-btn left-scroll-btn">
        <i class="fas fa-chevron-left"></i>
    </button>
    <button class="scroll-btn right-scroll-btn">
        <i class="fas fa-chevron-right"></i>
    </button>

    <div class="news-slider" id="newsSlider">
        {% for item in items %}
        <div class="card news-card shadow-sm border-0">
            <div class="card-header text-white fw-semibold 
                {% if item.posted_as == 'News' %}bg-primary{% else %}bg-success{% endif %}">
                {{ item.title|truncatechars:50 }}
            </div>

            <div class="card-body small">
                <div class="summary-text">{{ item.summary }}</div>
                <span class="read-more">Read More</span>
            </div>

            <div class="card-footer text-end bg-light small text-muted">
                <i class="fa fa-calendar-alt me-1"></i> {{ item.updated_date|timesince }} ago
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Read more toggle
        document.querySelectorAll(".read-more").forEach(function (btn) {
            btn.addEventListener("click", function () {
                const summary = this.previousElementSibling;
                summary.classList.toggle("expanded");
                this.textContent = summary.classList.contains("expanded") ? "Read Less" : "Read More";
            });
        });

        // Scroll buttons
        const scrollContainer = document.getElementById("newsSlider");
        document.querySelector(".left-scroll-btn").addEventListener("click", () => {
            scrollContainer.scrollBy({ left: -300, behavior: 'smooth' });
        });
        document.querySelector(".right-scroll-btn").addEventListener("click", () => {
            scrollContainer.scrollBy({ left: 300, behavior: 'smooth' });
        });
    });
</script>
{% else %}
<div class="text-center text-muted my-5">
    <i class="fa-regular fa-folder-open fa-2x mb-3"></i>
    <p>No news or events available at the moment.</p>
</div>
{% endif %}
<h2>{{ page_title }}</h2>
<p>Total Attendance Reports: {{ total_attendance_reports }}</p>
<a href="{% url 'parent_view_attendance' %}">View Attendance Reports</a>
<a href="{% url 'parent_view_profile' %}">View Profile</a>
<a href="{% url 'parent_manage_attendance_reports' %}">Manage Attendance Reports</a>
<h4>Your Children</h4>

{% if students %}
    <div class="row">
        {% for student in students %}
            <div class="col-md-6 mb-3">
                <div class="card shadow">
                    <div class="card-body">
                        <h5>{{ student.admin.first_name }} {{ student.admin.last_name }}</h5>
                        <p><strong>Grade:</strong> {{ student.grade.name }}</p>
                        <p><strong>Gender:</strong> {{ student.admin.gender }}</p>
                        <p><strong>Email:</strong> {{ student.admin.email }}</p>
                        <p><strong>School:</strong> {{ student.school.name }}</p>
                        <!-- Add more fields as needed -->
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
{% else %}
    <p>You have no children linked to your account.</p>
{% endif %}


{% endblock %}
